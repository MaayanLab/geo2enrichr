import unittest

from g2e.core import softutils
from g2e.core.analysis import pca


class TestPca(unittest.TestCase):

    def setUp(self):
        f = file('tests/data/example_input.txt')
        self.soft_file = softutils.maker.from_file(f, {
            'title': 'example_input'
        })
        self.maxDiff = 10000

    def testFromSoftFile(self):
        pca_coords = pca.from_soft_file(self.soft_file)
        self.assertEqual(
            pca_coords['ranges'],
            [
                [0.6435256981767972, 0.6703195836870222, 0.6311853957525526],
                [-0.6152954045010951, -0.558675463181043, -0.3236588851608794]
            ]
        )
        self.assertEqual(
            pca_coords['series'],
            [
                {
                    'data': [
                        {'y': 0.13265488593017255, 'x': -0.55935945863735914, 'z': -0.11891401983619786, 'name': 'a'},
                        {'y': -0.20118458954443674, 'x': -0.45007886164973149, 'z': -0.14531037084196641, 'name': 'b'},
                        {'y': 0.46119833934819421, 'x': -0.38139416196270082, 'z': -0.18470493921631115, 'name': 'c'},
                        {'y': 0.1789867958971956, 'x': -0.20666200387441686, 'z': -0.04961923961009454, 'name': 'd'},
                        {'y': 0.058499570528348178, 'x': -0.55168063970475478, 'z': 0.020557696585461489, 'name': 'e'},
                        {'y': -0.17340799145134847, 'x': -0.19840281519933564, 'z': -0.050027917393402434, 'name': 'f'},
                        {'y': -0.50788678471003901, 'x': -0.24660116287546213, 'z': -0.027459728206716615, 'name': 'g'},
                        {'y': -0.21136591651095152, 'x': -0.17729997334172662, 'z': -0.1047728634415559, 'name': 'h'},
                        {'y': 0.034985832825609242, 'x': 0.0082947951442276582, 'z': -0.017788833545667862, 'name': 'i'},
                        {'y': -0.31271726285700835, 'x': 0.0062857460163505321, 'z': -0.030673939675734441, 'name': 'j'},
                        {'y': 0.04634727401099184, 'x': -0.01927208006491557, 'z': 0.070396729151010209, 'name': 'k'},
                        {'y': 0.31470470525059624, 'x': 0.015213130437692526, 'z': -0.01193608082627646, 'name': 'l'},
                        {'y': 0.038990395945903492, 'x': 0.3162394583895709, 'z': -0.057185407754544643, 'name': 'm'},
                        {'y': -0.35008431539424523, 'x': 0.019544426892171823, 'z': -0.081906263069962265, 'name': 'n'},
                        {'y': 0.11400333814247518, 'x': 0.26978148721322748, 'z': -0.27279875783474616, 'name': 'o'},
                        {'y': 0.10822271864287178, 'x': 0.23025357062701485, 'z': -0.080476354192303839, 'name': 'p'},
                        {'y': 0.60938143971547465, 'x': -0.2589980597864795, 'z': 0.011570359130843403, 'name': 'q'},
                        {'y': -0.27141375844726306, 'x': -0.3877012110313876, 'z': 0.33977591963740783, 'name': 'r'},
                        {'y': 0.084396603340073456, 'x': 0.58502336197890648, 'z': -0.23209159406350785, 'name': 's'},
                        {'y': -0.23807464964250524, 'x': 0.27659034013197431, 'z': -0.29423535014625396, 'name': 't'}
                    ],
                    'name': 'control'
                },
                {
                    'data': [
                        {'y': 0.18977768522347593, 'x': 0.143693167246631, 'z': 0.17832423969678102, 'name': 'u'},
                        {'y': 0.01359413313176901, 'x': 0.49583221302681013, 'z': 0.12606797243247292, 'name': 'v'},
                        {'y': 0.028112299245235638, 'x': 0.58400125918440515, 'z': -0.036032340038298236, 'name': 'w'},
                        {'y': -0.037425694582454358, 'x': 0.10830479591811989, 'z': 0.57380490522959327, 'name': 'x'},
                        {'y': 0.17443794213575883, 'x': 0.21506116226087366, 'z': 0.42802698264900402, 'name': 'y'},
                        {'y': -0.28473299617388659, 'x': 0.16333151366029336, 'z': 0.047409195180967846, 'name': 'z'}
                    ],
                    'name': 'treatment'
                }
            ]
        )
