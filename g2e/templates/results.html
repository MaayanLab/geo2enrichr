{% extends 'wrapper.html' %}
{% block body %}

    <script src="static/js/results.js"></script>

    <div class="results">
        <h1>Results</h1>
        <table>
            <caption class="top">Share</caption>
            <tbody>
                <tr>
                    <td>Permanent link to these results</td>
                    <td>{{ permanent_link }}</td>
                </tr>
            </tbody>
        </table>

        {% if gene_signature.tags|length > 0 %}
            <table>
                <caption>Tags</caption>
                <tr>
                    <td></td>
                    <td>
                        {% for tag in gene_signature.tags %}
                            <a href="{{ tags_url }}/{{ tag.name }}">{{ tag.name }}</a>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                </tr>
            </table>
        {% endif %}

        <table>
            <caption>SOFT file</caption>
            <tr>
                <td>Description</td>
                <td>{{ gene_signature.soft_file.name }}</td>
            </tr>
            <tr>
                <td>Platform</td>
                <td>{{ gene_signature.soft_file.platform }}</td>
            </tr>
            <tr>
                <td>Normalized</td>
                <td>{{ gene_signature.soft_file.normalize }}</td>
            </tr>
            <tr title="Parsed and cleaned SOFT file, with GEO metadata removed and only the control and samples listed.">
                <td>Parsed SOFT file</td>
                <td>
                    <a href="{{ gene_signature.soft_file.text_file }}" target="_blank">Download</a>
                </td>
            </tr>
        </table>
    
        <table>
            <caption>Metadata</caption>
            <tr>
                <td>Differential expression method</td>
                <td>{{ gene_signature.required_metadata.diff_exp_method.name }}</td>
            </tr>
            <tr>
                <td>Cutoff</td>
                <td>{{ gene_signature.required_metadata.cutoff }}</td>
            </tr>
            <tr>
                <td>Correction method</td>
                <td>{{ gene_signature.required_metadata.ttest_correction_method.name }}</td>
            </tr>

            {% for opt_meta in gene_signature.optional_metadata %}
                <tr>
                    <td class="capitalize-initial">{{ opt_meta.name }}</td>
                    <td>{{ opt_meta.value }}</td>
                </tr>
            {% endfor %}
        
        </table>

        <table class="gene-lists">
            <caption>External Links and Downloads</caption>
            <thead>
                <tr>
                    <td></td>
                    <td title="Text file containing a gene list resulting from differential expression analysis.">Gene lists</td>
                    <td title="Perform enrichment analysis against over 70 gene set libraries with Enrichr, a popular gene set enrichment analysis tool.">Enrichr</td>
                    <td title="Identify drugs that can potentially reverse expression using expression signatures from the LINCS L1000 small-molecule transcriptomics datasets processed with the Characteristic Direction method.">L1000CDS2</td>
                    {% if show_paea %}
                        <td title="Perform principle angle enrichment analysis against over 70 gene set libraries.">PAEA</td>
                    {% endif %}
                </tr>
            </thead>
            {% for gene_list in gene_signature.gene_lists %}
                <tr>
                    <td>{{ gene_list.direction_as_string }}</td>
                    <td>
                        <a href="genelist/{{ gene_list.direction }}/{{ gene_signature.extraction_id }}" target="_blank">
                            <img src="static/image/download.png">
                        </a>
                    </td>
                    <td>
                        <a href="{{ gene_list.enrichr_link }}" target="_blank">
                            <img src="static/image/targetapp/enrichr.png">
                        </a>
                    </td>
                    {% if gene_list.l1000cds2_link != None and gene_list.l1000cds2_link != '' %}
                        <td>
                            <a href="{{ gene_list.l1000cds2_link }}" target="_blank">
                                <img src="static/image/targetapp/l1000cds2.png">
                            </a>
                        </td>
                    {% else %}
                        <td></td>
                    {% endif %}
                    {% if show_paea %}
                        {% if gene_list.paea_link != None and gene_list.paea_link != '' %}
                            <td>
                                <a href="{{ gene_list.paea_link }}" target="_blank">
                                    <img src="static/image/targetapp/paea.png">
                                </a>
                            </td>
                        {% else %}
                            <td></td>
                        {% endif %}
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    </div>
{% endblock %}